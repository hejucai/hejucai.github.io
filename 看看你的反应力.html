<!DOCTYPE html>
<html>
  <head>
    <title>贪吃蛇游戏</title>
    <style>
      #gameCanvas {
        background-color: #000;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script>
      // 获取画布和绘图上下文
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // 设置游戏参数
      const gridSize = 20;
      const canvasSize = canvas.width / gridSize;
      const initialSnakeLength = 3;
      const initialSnakeX = Math.floor(canvasSize / 2);
      const initialSnakeY = Math.floor(canvasSize / 2);
      const initialAppleX = Math.floor(Math.random() * canvasSize);
      const initialAppleY = Math.floor(Math.random() * canvasSize);

      // 设置贪吃蛇的初始位置和大小
      let snake = [];
      for (let i = 0; i < initialSnakeLength; i++) {
        snake.push({ x: initialSnakeX - i, y: initialSnakeY });
      }

      // 设置贪吃蛇的初始速度
      let snakeXChange = 0.1;
      let snakeYChange = 0.1;

      // 设置苹果的位置
      let apple = { x: initialAppleX, y: initialAppleY };

      // 监听键盘按下事件
      document.addEventListener("keydown", changeDirection);

      function changeDirection(event) {
        if (event.code === "ArrowLeft" && snakeXChange !== 1) {
          snakeXChange = -1;
          snakeYChange = 0;
        } else if (event.code === "ArrowRight" && snakeXChange !== -1) {
          snakeXChange = 1;
          snakeYChange = 0;
        } else if (event.code === "ArrowUp" && snakeYChange !== 1) {
          snakeYChange = -1;
          snakeXChange = 0;
        } else if (event.code === "ArrowDown" && snakeYChange !== -1) {
          snakeYChange = 1;
          snakeXChange = 0;
        }
      }

      // 游戏主循环
      function gameLoop() {
        // 更新贪吃蛇的位置
        const head = { x: snake[0].x + snakeXChange, y: snake[0].y + snakeYChange };
        snake.unshift(head);
        if (head.x === apple.x && head.y === apple.y) {
          // 贪吃蛇吃到了苹果，增加长度并生成新的苹果
          generateApple();
        } else {
          // 贪吃蛇没有吃到苹果，移除尾部
          snake.pop();
        }

        // 检查游戏是否结束
        if (isGameOver()) {
          alert("游戏结束！");
          resetGame();
          return;
        }

        // 清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 绘制贪吃蛇
        drawSnake();

        // 绘制苹果
        drawApple();

        // 循环调用游戏主循环
        requestAnimationFrame(gameLoop);
      }

      // 绘制贪吃蛇
      function drawSnake() {
        snake.forEach((segment) => {
          ctx.fillStyle = "#0f0";
          ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
        });
      }

      // 绘制苹果
      function drawApple() {
        ctx.fillStyle = "#f00";
        ctx.fillRect(apple.x * gridSize, apple.y * gridSize, gridSize, gridSize);
      }

      // 生成新的苹果
      function generateApple() {
        apple.x = Math.floor(Math.random() * canvasSize);
        apple.y = Math.floor(Math.random() * canvasSize);
      }

      // 检查游戏是否结束
      function isGameOver() {
        const head = snake[0];

        // 检查是否撞墙
        if (head.x < 0 || head.x >= canvasSize || head.y < 0 || head.y >= canvasSize) {
          return true;
        }

        // 检查是否撞到自己
        for (let i = 1; i < snake.length; i++) {
          if (head.x === snake[i].x && head.y === snake[i].y) {
            return true;
          }
        }

        return false;
      }

      // 重置游戏
      function resetGame() {
        snake = [];
        for (let i = 0; i < initialSnakeLength; i++) {
          snake.push({ x: initialSnakeX - i, y: initialSnakeY });
        }
        snakeXChange = 1;
        snakeYChange = 0;
        generateApple();
      }

      // 启动游戏主循环
      gameLoop();
    </script>
  </body>
</html>